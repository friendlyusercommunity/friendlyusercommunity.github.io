<!DOCTYPE html>
<html >
<head>
  <meta charset="UTF-8">
  <title>FUC Events</title>
</head>
<body>
  <style>
    body{
      background: #070707;
      font-size: 12px;
      color: white;
    }

    *{
      box-sizing: border-box;
    }

    body > header img{
      margin: auto;
      display: block;
    }

    .loading{
      width: 100%;
      text-align: center;
    }

    .eventList{
      padding: 0;
      margin: auto;
      display: flex;
      flex-flow: column;
      justify-content: space-around;
    }

    .eventList li{
      display: block;
      width: 40em;
      height: 5em;
      margin: .5em auto;
      font-size: 1em;
      color: white;
    }

    .eventList article{
      position: relative;
      overflow: hidden;
      height: 100%;
      width: 100%;
      border-radius: .5em;
      border: .2em solid white;
    }

    .eventList article header{
      font-size: 1.5em;
      color: black;
      background-color: #dbae62;
      padding: .25em;
    }

    .eventList article header h3{
      padding: 0;
      margin: 0;
      display: inline;
    }

    .eventList article header span{
      float: right;
    }

    .eventList article header span.now{
      color: green;
    }

    .eventList article header span.past{
      color: red;
    }

    .eventList article header a.link{
      margin-left: .25em;
      color: #070707;
    }

    .eventList article header a.link:hover{

    }

    .eventList article main{
      //position: absolute;
      padding: .25em .5em;
    }

    .eventList article aside{
      float: right;
    }
  </style>
  <header>
    <img src="img/eventsheader.png">
  </header>

  <ul id="app" class="eventList">
    <span class="loading" v-if="loading">Loading...</span>
    <template v-if="!loading" v-for="event in events">
      <li>
        <article>
          <header>
            <h3>{{event['gsx$name']['$t']}}</h3>
            <a class='link' v-if="event['gsx$link']['$t'] && event['gsx$linktext']['$t']" :href="event['gsx$link']['$t']">{{event['gsx$linktext']['$t']}}</a>
            <span v-bind:class="{past: event.moment <= pastMoment, now: event.moment < now && event.moment >= pastMoment}">{{until(event.moment)}}</span>
          </header>
           <main>{{event.moment.local().format('dddd')}} at {{event.moment.local().format('h:mm:ss A')}}. <aside>Hosted by: {{event['gsx$host']['$t']}}</aside></main>
        </article>
      </li>
    </li>
  </ul>
  </template>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/vue/2.0.5/vue.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.11/moment-timezone-with-data.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.16.6/lodash.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
  <script>
    var app = new Vue({
      el: '#app',
      data: {
        SHEET_ID: '11UXThup1CBvo-CcowJ8E_4KY2JBMpiv5DS09BzqSLis',
        loading: true,
        events: null,
        now: moment(),
        pastMoment: moment().add(-2, "hours"),
        aux: function(moment){
          return moment >= this.pastMoment ? "is" : "was";
        },
        until: function(moment){
          if(moment > this.now){
            return this.now.to(moment, true);
          } else if(moment >= this.pastMoment){
            return "NOW";
          } else {
            return this.now.to(moment);
          }
        }
      },

      created: function(){
        this.fetchData();
      },
      methods: {
        fetchData: function(){
          var that = this;
          this.loading = true;
          $.getJSON('https://spreadsheets.google.com/feeds/list/' + this.SHEET_ID + '/od6/public/values?alt=json', function(d, err){
            var events = d.feed.entry;
            for(i = events.length - 1; i >= 0; i--){
              events[i].moment = moment.tz(events[i]['gsx$time']['$t'], 'YYYY-MMM-DD HH:mm', "GMT");
            }
            that.events = events;
            that.loading = false;
            console.log(that.events);
          });
        }
      },
      computed: {
        time: function(){return _.sortBy(this.filteredEvents, "moment")},
        filteredEvents: function(){
          return this.events.filter(function(event){
            return event['gsx$host']['$t'] !== ""
          });
        }
      }
    });
  </script>
</body>
</html>
